<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Newsfeed - Top Stories Aggregator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; line-height: 1.6; color: #333; background: #f8f9fa; }
        header { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); color: white; padding: 2rem 0; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .subtitle { font-size: 1.2rem; opacity: 0.9; }
        .controls { background: white; padding: 1.5rem 2rem; display: flex; justify-content: center; gap: 1rem; box-shadow: 0 2px 10px rgba(0,0,0,0.05); max-width: 1200px; margin: 0 auto; flex-wrap: wrap; }
        button { background: #3b82f6; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s; }
        button:hover { background: #1d4ed8; transform: translateY(-1px); }
        button:disabled { background: #9ca3af; cursor: not-allowed; transform: none; }
        .status { padding: 1rem; background: #10b981; color: white; border-radius: 8px; margin: 1rem auto; display: none; max-width: 1200px; text-align: center; }
        .news-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 2rem; max-width: 1200px; margin: 2rem auto; padding: 0 2rem; }
        .news-card { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.1); transition: all 0.3s; height: 400px; display: flex; flex-direction: column; }
        .news-card:hover { transform: translateY(-8px); box-shadow: 0 16px 48px rgba(0,0,0,0.15); }
        .news-image { height: 200px; background-size: cover; background-position: center; position: relative; }
        .news-image::after { content: attr(data-source); position: absolute; bottom: 0.5rem; right: 0.5rem; background: rgba(0,0,0,0.7); color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; }
        .news-content { padding: 1.5rem; flex: 1; display: flex: flex-direction: column; }
        .news-headline { font-size: 1.3rem; font-weight: 700; margin-bottom: 0.8rem; line-height: 1.3; color: #1f2937; }
        .news-excerpt { color: #6b7280; margin-bottom: 1rem; flex: 1; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; }
        .news-link { color: #3b82f6; text-decoration: none; font-weight: 600; align-self: flex-start; transition: color 0.3s; }
        .news-link:hover { color: #1d4ed8; }
        .loading { grid-column: 1 / -1; text-align: center; padding: 4rem; font-size: 1.2rem; color: #6b7280; }
        .error { background: #ef4444; color: white; padding: 1rem; border-radius: 8px; text-align: center; margin: 1rem; }
        footer { background: #1f2937; color: white; text-align: center; padding: 2rem; margin-top: 4rem; }
        @media (max-width: 768px) { .news-grid { grid-template-columns: 1fr; padding: 0 1rem; } header h1 { font-size: 2rem; } }
    </style>
</head>
<body>
    <header>
        <h1>Daily Newsfeed</h1>
        <p class="subtitle">Top stories from Fox News, Breitbart, ESPN, Newsweek & more. Auto-refreshes daily.</p>
    </header>

    <div class="controls">
        <button onclick="loadNews()" id="refreshBtn">üîÑ Refresh Now (20 Stories)</button>
        <button onclick="clearCache()">üóëÔ∏è Clear Cache</button>
        <div class="status" id="status">Last updated: Never</div>
    </div>

    <div class="news-grid" id="newsGrid">
        <div class="loading">Click Refresh to load top stories! üì∞</div>
    </div>

    <footer>
        <p>Disclaimer: Aggregated from public RSS feeds. Always verify sources. Not affiliated with listed sites. Updates via JS cache (24h). For server auto-update at 11AM, deploy to Netlify/Vercel with cron.</p>
    </footer>

    <script>
        const RSS_FEEDS = [
            { url: 'https://moxie.foxnews.com/feedburner/latest.xml', source: 'Fox News' },
            { url: 'https://www.breitbart.com/feed/', source: 'Breitbart' },
            { url: 'http://www.espn.com/espn/rss/news', source: 'ESPN' },
            { url: 'https://www.newsweek.com/rss_search', source: 'Newsweek' },
            // Others for balance/diversity (total ~20 unique stories)
            { url: 'http://feeds.bbci.co.uk/news/rss.xml', source: 'BBC' },
            { url: 'http://rss.cnn.com/rss/edition.rss', source: 'CNN' },
            { url: 'https://www.reuters.com/rss', source: 'Reuters' }, // Note: Reuters RSS may vary; adjust if needed
            { url: 'https://feeds.npr.org/1001/rss.xml', source: 'NPR' },
            { url: 'https://www.theguardian.com/uk/rss', source: 'The Guardian' },
            { url: 'https://apnews.com/rss', source: 'AP News' }
        ];

        const CACHE_KEY = 'newsfeed_cache';
        const CACHE_EXPIRY = 24 * 60 * 60 * 1000; // 24 hours

        async function fetchRSS(url) {
            try {
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
                const response = await fetch(proxyUrl);
                const data = await response.json();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(data.contents, 'text/xml');
                return Array.from(xmlDoc.querySelectorAll('item')).slice(0, 3); // Top 3 per feed
            } catch (error) {
                console.error(`Error fetching ${url}:`, error);
                return [];
            }
        }

        function parseStory(item, source) {
            const title = item.querySelector('title')?.textContent || 'No title';
            const link = item.querySelector('link')?.textContent || '#';
            const description = item.querySelector('description')?.textContent || '';
            const pubDate = item.querySelector('pubDate')?.textContent || '';

            // Extract image from description or media
            let image = item.querySelector('media\\:content, media\\:thumbnail')?.getAttribute('url') || 
                       description.match(/<img[^>]+src=["'](.*?)["']/i)?.[1] ||
                       'https://via.placeholder.com/400x200/3b82f6/ffffff?text=News'; // Fallback

            const excerpt = description.replace(/<[^>]*>/g, '').substring(0, 150) + '...';

            return {
                title,
                link,
                image,
                excerpt,
                source,
                pubDate
            };
        }

        async function loadNews() {
            const refreshBtn = document.getElementById('refreshBtn');
            const grid = document.getElementById('newsGrid');
            const status = document.getElementById('status');

            refreshBtn.disabled = true;
            refreshBtn.textContent = 'Loading...';
            grid.innerHTML = '<div class="loading">Fetching top stories...</div>';

            try {
                // Check cache first
                const cached = JSON.parse(localStorage.getItem(CACHE_KEY));
                const now = Date.now();
                if (cached && (now - cached.timestamp) < CACHE_EXPIRY) {
                    displayNews(cached.stories);
                    status.textContent = `Last updated: ${new Date(cached.timestamp).toLocaleString()}`;
                    status.style.display = 'block';
                    return;
                }

                const allStories = [];
                for (const feed of RSS_FEEDS) {
                    const items = await fetchRSS(feed.url);
                    const stories = items.map(item => parseStory(item, feed.source));
                    allStories.push(...stories);
                    await new Promise(resolve => setTimeout(resolve, 500)); // Rate limit
                }

                // Dedupe by title + source, sort by pubDate (newest first), take top 20
                const uniqueStories = allStories
                    .filter((story, index, self) => 
                        index === self.findIndex(s => s.title === story.title && s.source === story.source)
                    )
                    .sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate))
                    .slice(0, 20);

                const newsData = { stories: uniqueStories, timestamp: now };
                localStorage.setItem(CACHE_KEY, JSON.stringify(newData));
                displayNews(uniqueStories);
                status.textContent = `Last updated: ${new Date(now).toLocaleString()} (Fresh!)`;
                status.style.display = 'block';

            } catch (error) {
                grid.innerHTML = '<div class="error">Error loading news. Check console. Try again?</div>';
                console.error('Load error:', error);
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.textContent = 'üîÑ Refresh Now (20 Stories)';
            }
        }

        function displayNews(stories) {
            const grid = document.getElementById('newsGrid');
            if (stories.length === 0) {
                grid.innerHTML = '<div class="error">No stories found. Try refreshing.</div>';
                return;
            }
            grid.innerHTML = stories.map(story => `
                <div class="news-card">
                    <div class="news-image" style="background-image: url('${story.image}');" data-source="${story.source}"></div>
                    <div class="news-content">
                        <a href="${story.link}" target="_blank" class="news-headline">${story.title}</a>
                        <p class="news-excerpt">${story.excerpt}</p>
                        <a href="${story.link}" target="_blank" class="news-link">Read full story ‚Üí</a>
                    </div>
                </div>
            `).join('');
        }

        function clearCache() {
            localStorage.removeItem(CACHE_KEY);
            document.getElementById('status').style.display = 'none';
            loadNews();
        }

        // Auto-load on page open
        window.addEventListener('load', loadNews);

        // Simulate daily refresh check (client-side approx; not precise 11AM)
        setInterval(() => {
            const cached = JSON.parse(localStorage.getItem(CACHE_KEY));
            if (!cached || (Date.now() - cached.timestamp) > CACHE_EXPIRY) {
                loadNews(); // Refresh if stale
            }
        }, 60 * 60 * 1000); // Check hourly
    </script>
</body>
</html>